fastgødning[StaldID %in% kvæg_fastgødning_StaldID, sum(TotGoednabDyr)],
ajle[StaldID %in% kvæg_ajle_StaldID, sum(TotGoednabDyr)])/1000,
TotTSabDyr_kt_year = c(gylle[StaldID %in% toklimastald_smågrise_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_smågrise_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_33_67_slagtesvin_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_50_75_slagtesvin_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_25_50_slagtesvin_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% løs_individuel_søer_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% farestald_delvis_spalte_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% farestald_fuldspalte_StaldID, sum(TotTSabDyr)],
dybstrøelse[StaldID %in% svin_dybstrøelse_StaldID, sum(TotTSabDyr)],
fastgødning[StaldID %in% svin_fastgødning_StaldID, sum(TotTSabDyr)],
ajle[StaldID %in% svin_ajle_StaldID, sum(TotTSabDyr)],
ude[StaldID %in% svin_ude_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_ringkanal_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_fast_skrab_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_spalter_skrab_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_hæld_fast_skrab_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_andre_hyppig_StaldID, sum(TotTSabDyr)],
dybstrøelse[StaldID %in% kvæg_dybstrøelse_StaldID, sum(TotTSabDyr)],
fastgødning[StaldID %in% kvæg_fastgødning_StaldID, sum(TotTSabDyr)],
ajle[StaldID %in% kvæg_ajle_StaldID, sum(TotTSabDyr)])/1000)
TotGoednabDyr_table[grepl('svin|smågrise|søer|slagtesvin', DyreType), Dyr := 'svin']
TotGoednabDyr_table[is.na(Dyr), Dyr := 'kvæg']
TotGoednabDyr_table <- merge.data.table(TotGoednabDyr_table, Goedn_dyretype, all.x = T)
TotGoednabDyr_table[, udbredelse_pr_dyr := TotGoednabDyr_kt_year/sum(TotGoednabDyr_kt_year) * 100, by= 'Dyr']
TotGoednabDyr_table[, udbredelse_pr_dyretype := TotGoednabDyr_kt_year/TotGoednabDyr * 100, by= 'DyreType']
ab_lager <- setDT(read_excel('../data/ab_lager.xlsx'))[
, lager_faktor := ab_lager/ab_dyr][, .(model_gruppe, lager_faktor)]
TotGoednabDyr_table <- merge.data.table(TotGoednabDyr_table, ab_lager, by = 'model_gruppe', all.x =  T)
TotGoednabDyr_table <- TotGoednabDyr_table[, TotGoednabLager_kt_year := TotGoednabDyr_kt_year * lager_faktor][order(-DyreType)]
# manure is kt produced per year
write.xlsx(TotGoednabDyr_table, '../output/TotGoedningabDyr.xlsx')
View(TotGoednabDyr_table)
rm(list = ls())
library(data.table)
library(openxlsx)
library(readxl)
dat <- fread('../data/dat_merged.csv')
Goedn_dyretype <- dat[!duplicated(dat[, .(GoedningsNavn, StaldID, DyrNavn)]), .(TotGoednabDyr = sum(TotGoednabDyr)/1000), by = c('DyreType')]
Goedn_dyretype <- Goedn_dyretype[!is.na(TotGoednabDyr)]
## SVIN
# gylle systemer
toklimastald_smågrise_StaldID <- c(20)
spalter_smågrise_StaldID <- c(46)
spalter_33_67_slagtesvin_StaldID <- c(47)
spalter_50_75_slagtesvin_StaldID <- c(72, 19)
spalter_25_50_slagtesvin_StaldID <- c(73)
løs_individuel_søer_StaldID <- c(60, 63, 8, 10, 80, 79)
farestald_delvis_spalte_StaldID <- c(64)
farestald_fuldspalte_StaldID <- c(65)
# dybstrøelse
svin_dybstrøelse_StaldID <- c(8, 10, 15, 19, 21, 79)
# fast gødning
svin_fastgødning_StaldID <- c(18, 62)
# ajle
svin_ajle_StaldID <- c(18, 62)
# ude
svin_ude_StaldID <- c(22, 78, 81)
## KVÆG
# gylle systemer
kvæg_ringkanal_StaldID <- c(6, 13)
kvæg_fast_skrab_StaldID <- c(5, 11)
kvæg_spalter_skrab_StaldID <- c(7, 14)
kvæg_hæld_fast_skrab_StaldID <- c(49)
kvæg_andre_hyppig_StaldID <- c(2, 4) # 2 is spaltegulvbokse, what is that?
# dybstrøelse
kvæg_dybstrøelse_StaldID <- c(9, 11, 12, 13, 14) #
# fast gødning
kvæg_fastgødning_StaldID <- c(3)
# ajle
kvæg_ajle_StaldID <- c(3)
gylle <- dat[GoedningsNavn == 'Gylle' & (Scenarie == 'kontrol'|Scenarie == ""| is.na(Scenarie)), .(TotGoednabDyr = sum(TotGoednabDyr)), by = c('StaldID','GoedningsNavn')]
gylle <- gylle[!duplicated(gylle)]
dybstrøelse <- dat[grepl('Dybstrøelse', GoedningsNavn), .(TotGoednabDyr = sum(TotGoednabDyr), TotTSabDyr = TSabDyr/100 *sum(TotGoednabDyr)), by = c('StaldID')]
fastgødning <- dat[grepl('Fast gødning', GoedningsNavn), .(TotGoednabDyr = sum(TotGoednabDyr), TotTSabDyr = TSabDyr/100 *sum(TotGoednabDyr)), by = c('StaldID')]
ajle <- dat[GoedningsNavn == 'Ajle', .(TotGoednabDyr = sum(TotGoednabDyr), TotTSabDyr = TSabDyr/100 *sum(TotGoednabDyr)), by = c('StaldID')]
ude <- dat[GoedningsNavn == 'Ude', .(TotGoednabDyr = sum(TotGoednabDyr), TotTSabDyr = TSabDyr/100 *sum(TotGoednabDyr)), by = c('StaldID')]
TotGoednabDyr_table <- data.table(model_gruppe = c('toklimastald_smågrise',
'spalter_smågrise',
'spalter_33_67_slagtesvin',
'spalter_50_75_slagtesvin',
'spalter_25_50_slagtesvin',
'løs_individuel_søer',
'farestald_delvis_spalte',
'farestald_fuldspalte',
'svin_dybstrøelse',
'svin_fastgødning',
'svin_ajle',
'svin_ude',
'kvæg_ringkanal',
'kvæg_fast_skrab',
'kvæg_spalter_skrab',
'kvæg_hæld_fast_skrab',
'kvæg_andre_hyppig',
'kvæg_dybstrøelse',
'kvæg_fastgødning',
'kvæg_ajle'),
DyreType = c('smågrise',
'smågrise',
'slagtesvin',
'slagtesvin',
'slagtesvin',
'søer',
'søer',
'søer',
'svin',
'svin',
'svin',
'svin',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg'),
TotGoednabDyr_kt_year = c(gylle[StaldID %in% toklimastald_smågrise_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_smågrise_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_33_67_slagtesvin_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_50_75_slagtesvin_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_25_50_slagtesvin_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% løs_individuel_søer_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% farestald_delvis_spalte_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% farestald_fuldspalte_StaldID, sum(TotGoednabDyr)],
dybstrøelse[StaldID %in% svin_dybstrøelse_StaldID, sum(TotGoednabDyr)],
fastgødning[StaldID %in% svin_fastgødning_StaldID, sum(TotGoednabDyr)],
ajle[StaldID %in% svin_ajle_StaldID, sum(TotGoednabDyr)],
ude[StaldID %in% svin_ude_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_ringkanal_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_fast_skrab_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_spalter_skrab_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_hæld_fast_skrab_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_andre_hyppig_StaldID, sum(TotGoednabDyr)],
dybstrøelse[StaldID %in% kvæg_dybstrøelse_StaldID, sum(TotGoednabDyr)],
fastgødning[StaldID %in% kvæg_fastgødning_StaldID, sum(TotGoednabDyr)],
ajle[StaldID %in% kvæg_ajle_StaldID, sum(TotGoednabDyr)])/1000,
TotTSabDyr_kt_year = c(gylle[StaldID %in% toklimastald_smågrise_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_smågrise_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_33_67_slagtesvin_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_50_75_slagtesvin_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_25_50_slagtesvin_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% løs_individuel_søer_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% farestald_delvis_spalte_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% farestald_fuldspalte_StaldID, sum(TotTSabDyr)],
dybstrøelse[StaldID %in% svin_dybstrøelse_StaldID, sum(TotTSabDyr)],
fastgødning[StaldID %in% svin_fastgødning_StaldID, sum(TotTSabDyr)],
ajle[StaldID %in% svin_ajle_StaldID, sum(TotTSabDyr)],
ude[StaldID %in% svin_ude_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_ringkanal_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_fast_skrab_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_spalter_skrab_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_hæld_fast_skrab_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_andre_hyppig_StaldID, sum(TotTSabDyr)],
dybstrøelse[StaldID %in% kvæg_dybstrøelse_StaldID, sum(TotTSabDyr)],
fastgødning[StaldID %in% kvæg_fastgødning_StaldID, sum(TotTSabDyr)],
ajle[StaldID %in% kvæg_ajle_StaldID, sum(TotTSabDyr)])/1000)
TotGoednabDyr_table <- data.table(model_gruppe = c('toklimastald_smågrise',
'spalter_smågrise',
'spalter_33_67_slagtesvin',
'spalter_50_75_slagtesvin',
'spalter_25_50_slagtesvin',
'løs_individuel_søer',
'farestald_delvis_spalte',
'farestald_fuldspalte',
'svin_dybstrøelse',
'svin_fastgødning',
'svin_ajle',
'svin_ude',
'kvæg_ringkanal',
'kvæg_fast_skrab',
'kvæg_spalter_skrab',
'kvæg_hæld_fast_skrab',
'kvæg_andre_hyppig',
'kvæg_dybstrøelse',
'kvæg_fastgødning',
'kvæg_ajle'),
DyreType = c('smågrise',
'smågrise',
'slagtesvin',
'slagtesvin',
'slagtesvin',
'søer',
'søer',
'søer',
'svin',
'svin',
'svin',
'svin',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg'),
TotGoednabDyr_kt_year = c(gylle[StaldID %in% toklimastald_smågrise_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_smågrise_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_33_67_slagtesvin_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_50_75_slagtesvin_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_25_50_slagtesvin_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% løs_individuel_søer_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% farestald_delvis_spalte_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% farestald_fuldspalte_StaldID, sum(TotGoednabDyr)],
dybstrøelse[StaldID %in% svin_dybstrøelse_StaldID, sum(TotGoednabDyr)],
fastgødning[StaldID %in% svin_fastgødning_StaldID, sum(TotGoednabDyr)],
ajle[StaldID %in% svin_ajle_StaldID, sum(TotGoednabDyr)],
ude[StaldID %in% svin_ude_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_ringkanal_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_fast_skrab_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_spalter_skrab_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_hæld_fast_skrab_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_andre_hyppig_StaldID, sum(TotGoednabDyr)],
dybstrøelse[StaldID %in% kvæg_dybstrøelse_StaldID, sum(TotGoednabDyr)],
fastgødning[StaldID %in% kvæg_fastgødning_StaldID, sum(TotGoednabDyr)],
ajle[StaldID %in% kvæg_ajle_StaldID, sum(TotGoednabDyr)])/1000)
View(TotGoednabDyr_table)
TotGoednabDyr_table <- data.table(model_gruppe = c('toklimastald_smågrise',
'spalter_smågrise',
'spalter_33_67_slagtesvin',
'spalter_50_75_slagtesvin',
'spalter_25_50_slagtesvin',
'løs_individuel_søer',
'farestald_delvis_spalte',
'farestald_fuldspalte',
'svin_dybstrøelse',
'svin_fastgødning',
'svin_ajle',
'svin_ude',
'kvæg_ringkanal',
'kvæg_fast_skrab',
'kvæg_spalter_skrab',
'kvæg_hæld_fast_skrab',
'kvæg_andre_hyppig',
'kvæg_dybstrøelse',
'kvæg_fastgødning',
'kvæg_ajle'),
DyreType = c('smågrise',
'smågrise',
'slagtesvin',
'slagtesvin',
'slagtesvin',
'søer',
'søer',
'søer',
'svin',
'svin',
'svin',
'svin',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg'),
TotGoednabDyr_kt_year = c(gylle[StaldID %in% toklimastald_smågrise_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_smågrise_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_33_67_slagtesvin_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_50_75_slagtesvin_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_25_50_slagtesvin_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% løs_individuel_søer_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% farestald_delvis_spalte_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% farestald_fuldspalte_StaldID, sum(TotGoednabDyr)],
dybstrøelse[StaldID %in% svin_dybstrøelse_StaldID, sum(TotGoednabDyr)],
fastgødning[StaldID %in% svin_fastgødning_StaldID, sum(TotGoednabDyr)],
ajle[StaldID %in% svin_ajle_StaldID, sum(TotGoednabDyr)],
ude[StaldID %in% svin_ude_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_ringkanal_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_fast_skrab_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_spalter_skrab_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_hæld_fast_skrab_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_andre_hyppig_StaldID, sum(TotGoednabDyr)],
dybstrøelse[StaldID %in% kvæg_dybstrøelse_StaldID, sum(TotGoednabDyr)],
fastgødning[StaldID %in% kvæg_fastgødning_StaldID, sum(TotGoednabDyr)],
ajle[StaldID %in% kvæg_ajle_StaldID, sum(TotGoednabDyr)])/1000,
TotTSabDyr_kt_year = c(gylle[StaldID %in% toklimastald_smågrise_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_smågrise_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_33_67_slagtesvin_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_50_75_slagtesvin_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_25_50_slagtesvin_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% løs_individuel_søer_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% farestald_delvis_spalte_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% farestald_fuldspalte_StaldID, sum(TotTSabDyr)],
dybstrøelse[StaldID %in% svin_dybstrøelse_StaldID, sum(TotTSabDyr)],
fastgødning[StaldID %in% svin_fastgødning_StaldID, sum(TotTSabDyr)],
ajle[StaldID %in% svin_ajle_StaldID, sum(TotTSabDyr)],
ude[StaldID %in% svin_ude_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_ringkanal_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_fast_skrab_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_spalter_skrab_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_hæld_fast_skrab_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_andre_hyppig_StaldID, sum(TotTSabDyr)],
dybstrøelse[StaldID %in% kvæg_dybstrøelse_StaldID, sum(TotTSabDyr)],
fastgødning[StaldID %in% kvæg_fastgødning_StaldID, sum(TotTSabDyr)],
ajle[StaldID %in% kvæg_ajle_StaldID, sum(TotTSabDyr)])/1000)
View(dat)
rm(list = ls())
library(data.table)
library(openxlsx)
library(readxl)
dat <- fread('../data/dat_merged.csv')
Goedn_dyretype <- dat[!duplicated(dat[, .(GoedningsNavn, StaldID, DyrNavn)]), .(TotGoednabDyr = sum(TotGoednabDyr)/1000), by = c('DyreType')]
Goedn_dyretype <- Goedn_dyretype[!is.na(TotGoednabDyr)]
## SVIN
# gylle systemer
toklimastald_smågrise_StaldID <- c(20)
spalter_smågrise_StaldID <- c(46)
spalter_33_67_slagtesvin_StaldID <- c(47)
spalter_50_75_slagtesvin_StaldID <- c(72, 19)
spalter_25_50_slagtesvin_StaldID <- c(73)
løs_individuel_søer_StaldID <- c(60, 63, 8, 10, 80, 79)
farestald_delvis_spalte_StaldID <- c(64)
farestald_fuldspalte_StaldID <- c(65)
# dybstrøelse
svin_dybstrøelse_StaldID <- c(8, 10, 15, 19, 21, 79)
# fast gødning
svin_fastgødning_StaldID <- c(18, 62)
# ajle
svin_ajle_StaldID <- c(18, 62)
# ude
svin_ude_StaldID <- c(22, 78, 81)
## KVÆG
# gylle systemer
kvæg_ringkanal_StaldID <- c(6, 13)
kvæg_fast_skrab_StaldID <- c(5, 11)
kvæg_spalter_skrab_StaldID <- c(7, 14)
kvæg_hæld_fast_skrab_StaldID <- c(49)
kvæg_andre_hyppig_StaldID <- c(2, 4) # 2 is spaltegulvbokse, what is that?
# dybstrøelse
kvæg_dybstrøelse_StaldID <- c(9, 11, 12, 13, 14) #
# fast gødning
kvæg_fastgødning_StaldID <- c(3)
# ajle
kvæg_ajle_StaldID <- c(3)
gylle <- dat[GoedningsNavn == 'Gylle' & (Scenarie == 'kontrol'|Scenarie == ""| is.na(Scenarie)), .(TotGoednabDyr = sum(TotGoednabDyr), TotTSabDyr = sum(TotGoednabDyr * TSabDyr/100)), by = c('StaldID','GoedningsNavn')]
#gylle <- gylle[!duplicated(gylle)]
dybstrøelse <- dat[grepl('Dybstrøelse', GoedningsNavn), .(TotGoednabDyr = sum(TotGoednabDyr), TotTSabDyr = sum(TotGoednabDyr * TSabDyr/100)), by = c('StaldID')]
fastgødning <- dat[grepl('Fast gødning', GoedningsNavn), .(TotGoednabDyr = sum(TotGoednabDyr), TotTSabDyr = sum(TotGoednabDyr * TSabDyr/100)), by = c('StaldID')]
ajle <- dat[GoedningsNavn == 'Ajle', .(TotGoednabDyr = sum(TotGoednabDyr), TotTSabDyr = sum(TotGoednabDyr * TSabDyr/100)), by = c('StaldID')]
ude <- dat[GoedningsNavn == 'Ude', .(TotGoednabDyr = sum(TotGoednabDyr), TotTSabDyr = sum(TotGoednabDyr * TSabDyr/100)), by = c('StaldID')]
TotGoednabDyr_table <- data.table(model_gruppe = c('toklimastald_smågrise',
'spalter_smågrise',
'spalter_33_67_slagtesvin',
'spalter_50_75_slagtesvin',
'spalter_25_50_slagtesvin',
'løs_individuel_søer',
'farestald_delvis_spalte',
'farestald_fuldspalte',
'svin_dybstrøelse',
'svin_fastgødning',
'svin_ajle',
'svin_ude',
'kvæg_ringkanal',
'kvæg_fast_skrab',
'kvæg_spalter_skrab',
'kvæg_hæld_fast_skrab',
'kvæg_andre_hyppig',
'kvæg_dybstrøelse',
'kvæg_fastgødning',
'kvæg_ajle'),
DyreType = c('smågrise',
'smågrise',
'slagtesvin',
'slagtesvin',
'slagtesvin',
'søer',
'søer',
'søer',
'svin',
'svin',
'svin',
'svin',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg',
'kvæg'),
TotGoednabDyr_kt_year = c(gylle[StaldID %in% toklimastald_smågrise_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_smågrise_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_33_67_slagtesvin_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_50_75_slagtesvin_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% spalter_25_50_slagtesvin_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% løs_individuel_søer_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% farestald_delvis_spalte_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% farestald_fuldspalte_StaldID, sum(TotGoednabDyr)],
dybstrøelse[StaldID %in% svin_dybstrøelse_StaldID, sum(TotGoednabDyr)],
fastgødning[StaldID %in% svin_fastgødning_StaldID, sum(TotGoednabDyr)],
ajle[StaldID %in% svin_ajle_StaldID, sum(TotGoednabDyr)],
ude[StaldID %in% svin_ude_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_ringkanal_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_fast_skrab_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_spalter_skrab_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_hæld_fast_skrab_StaldID, sum(TotGoednabDyr)],
gylle[StaldID %in% kvæg_andre_hyppig_StaldID, sum(TotGoednabDyr)],
dybstrøelse[StaldID %in% kvæg_dybstrøelse_StaldID, sum(TotGoednabDyr)],
fastgødning[StaldID %in% kvæg_fastgødning_StaldID, sum(TotGoednabDyr)],
ajle[StaldID %in% kvæg_ajle_StaldID, sum(TotGoednabDyr)])/1000,
TotTSabDyr_kt_year = c(gylle[StaldID %in% toklimastald_smågrise_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_smågrise_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_33_67_slagtesvin_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_50_75_slagtesvin_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% spalter_25_50_slagtesvin_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% løs_individuel_søer_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% farestald_delvis_spalte_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% farestald_fuldspalte_StaldID, sum(TotTSabDyr)],
dybstrøelse[StaldID %in% svin_dybstrøelse_StaldID, sum(TotTSabDyr)],
fastgødning[StaldID %in% svin_fastgødning_StaldID, sum(TotTSabDyr)],
ajle[StaldID %in% svin_ajle_StaldID, sum(TotTSabDyr)],
ude[StaldID %in% svin_ude_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_ringkanal_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_fast_skrab_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_spalter_skrab_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_hæld_fast_skrab_StaldID, sum(TotTSabDyr)],
gylle[StaldID %in% kvæg_andre_hyppig_StaldID, sum(TotTSabDyr)],
dybstrøelse[StaldID %in% kvæg_dybstrøelse_StaldID, sum(TotTSabDyr)],
fastgødning[StaldID %in% kvæg_fastgødning_StaldID, sum(TotTSabDyr)],
ajle[StaldID %in% kvæg_ajle_StaldID, sum(TotTSabDyr)])/1000)
View(TotGoednabDyr_table)
TotGoednabDyr_table[grepl('svin|smågrise|søer|slagtesvin', DyreType), Dyr := 'svin']
TotGoednabDyr_table[is.na(Dyr), Dyr := 'kvæg']
TotGoednabDyr_table <- merge.data.table(TotGoednabDyr_table, Goedn_dyretype, all.x = T)
TotGoednabDyr_table[, udbredelse_pr_dyr := TotGoednabDyr_kt_year/sum(TotGoednabDyr_kt_year) * 100, by= 'Dyr']
TotGoednabDyr_table[, udbredelse_pr_dyretype := TotGoednabDyr_kt_year/TotGoednabDyr * 100, by= 'DyreType']
ab_lager <- setDT(read_excel('../data/ab_lager.xlsx'))[
, lager_faktor := ab_lager/ab_dyr][, .(model_gruppe, lager_faktor)]
TotGoednabDyr_table <- merge.data.table(TotGoednabDyr_table, ab_lager, by = 'model_gruppe', all.x =  T)
TotGoednabDyr_table <- TotGoednabDyr_table[, TotGoednabLager_kt_year := TotGoednabDyr_kt_year * lager_faktor][order(-DyreType)]
# manure is kt produced per year
write.xlsx(TotGoednabDyr_table, '../output/TotGoedningabDyr.xlsx')
View(TotGoednabDyr_table)
setwd("C:/Users/au277187/OneDrive - Aarhus universitet/Documents/GitHub/AU-BCE-EE/Dalby-2024-KVIK/scripts")
# Frederik Rask Dalby, 01.03.2024
rm(list = ls())
library(data.table)
library(readxl)
dat_VS <- data.table(read_excel('../data/original/Til Anders Peter og Frederik 14122023.xlsx', sheet = 1, skip = 1))
dat_anim <- data.table(read_excel('../data/original/Til Anders Peter og Frederik 14122023.xlsx', sheet = 2, skip = 1))
#fix mismatch in names
dat_anim[DyrNavn == 'Smågrise', DyrNavn := 'Smågrise, 7,5-30 kg']
dat_anim[DyrNavn == 'Slagtesvin', DyrNavn := 'Slagtesvin, 30-100,0 kg']
dat <- merge.data.table(dat_VS, dat_anim)
#change some names
old_names <- c('FirstOfAntalDyr', 'Ton gødning ab dyr', 'Tørstof pct ab dyr')
new_names <- c('NDyr', 'GoednabDyr', 'TSabDyr')
setnames(dat, old = old_names, new = new_names)
NDyr_farestald <- dat[StaldID %in% c(64, 65) & !duplicated(StaldID), sum(NDyr)]
NDyr_løbestald <- dat[DyrID == 12 & !duplicated(StaldID) & !StaldID %in% c(64, 65), sum(NDyr)]
frac_farestald <- NDyr_farestald/(NDyr_løbestald + NDyr_farestald)
frac_løbestald <- 1- frac_farestald
#make new coloumn "NDyr_mod" which can be directly multiplied with excretions to get yearly excretion.
dat[, NDyr_mod := NDyr]
dat[StaldID %in% c(64, 65), NDyr_mod := NDyr * 1/frac_farestald]
dat[!StaldID %in% c(64, 65) & DyrID == 12, NDyr_mod := NDyr * 1/frac_løbestald]
#calculate yearly excretions on columns
cols <- c('NabDyr', 'TANabDyr', 'GoednabDyr' )
new_cols <- paste0('Tot', cols)
dat[, (new_cols) := .SD * NDyr_mod, .SDcols = cols]
#
dyretype_goedning <- dat[, sum(TotGoednabDyr), by = 'DyreType']
#model dat
dat_model_pig <- data.table(t(read_excel('../model/Metanproduktion_Arrhenius_v8_30012024_efter_rettelse_fra_fagfællebedømmelse.xlsx')))
#model dat
dat_model_pig <- data.table(t(read_excel('../model/Metanproduktion_Arrhenius_v9.xlsx')))
#model dat
dat_model_pig <- data.table(t(read_excel('../model/Metanproduktion_Arrhenius_v9.xlsx')))
names(dat_model_pig) <- as.character(dat_model_pig[1, ])
dat_model_pig <- dat_model_pig[-c(1:2), ]
dat_model_cattle <- data.table(t(read_excel('../model/Metanproduktion_Arrhenius_v9.xlsx', sheet = 'Tabel_kvæg')))
names(dat_model_cattle) <- as.character(dat_model_cattle[1, ])
dat_model_cattle <- dat_model_cattle[-c(1:2), ]
dat_model <- rbind(dat_model_pig, dat_model_cattle, fill =T)
#fix names in model spreadsheet
old_names <- c('CH4-udledning stald, gylle ab dyr',
'CH4-udledning stald og for/afhent.tank, gylle ab dyr',
'CH4-udledning lager, gylle ab dyr',
'CH4-udledning, afgasset gylle, gylle ab dyr',
'CH4-produktion, biogasanlæg, gylle ab dyr',
'NH3-udledning ab stald, gylle',
'NH3-udledning ab lager, gylle',
'N2O-udledning direkte total, gylle',
'N2O-udledning indirekte total, gylle'
)
new_names <- c('CH4_dyr_stald', 'CH4_dyr_Stald_aft', 'CH4_dyr_lager', 'CH4_dyr_afg', 'CH4_dyr_biog',
'NH3_dyr_stald', 'NH3_dyr_lager', 'N2O_dyr_dir_tot', 'N2O_dyr_indir_tot'
)
setnames(dat_model, old = old_names, new = new_names)
dat_model <- dat_model[, c((new_names), 'GoedningsID') := lapply(.SD, as.numeric), .SDcols = c(new_names, 'GoedningsID')][, c(..new_names, 'StaldID', 'GoedningsID','Scenarie')]
View(dat_model)
View(dat)
rm(list = ls())
library(readxl)
library(data.table)
library(openxlsx)
dat <- fread('../data/dat_merged.csv')
test <- dat[StaldID == 14]
View(test)
View(test)
test <- dat[StaldID == 14 & GoedningsNavn == 'Gylle']
View(test)
test <- dat[StaldID == 14 & GoedningsNavn == 'Gylle' & scenarie == 'kontrol']
test <- dat[StaldID == 14 & GoedningsNavn == 'Gylle' & Scenarie == 'kontrol']
View(test)
sum(test$TotGoednabDyr)
test <- dat[StaldID == 7 & GoedningsNavn == 'Gylle' & Scenarie == 'kontrol']
sum(test$TotGoednabDyr)
